server {
    listen       80;
    server_name  localhost;

    location / {
      root      /usr/share/nginx/html;
      index     index.html;
      try_files $uri /index.html;
    }

    # Proxy GraphQL to PlayStation Store API
    location /ps-gql {
      proxy_pass https://web.np.playstation.com/api/graphql/v1/op;
      proxy_ssl_server_name on;
      proxy_set_header Host web.np.playstation.com;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      # Forward Apollo operation header (required upstream)
      proxy_set_header x-apollo-operation-name $http_x_apollo_operation_name;

      proxy_connect_timeout 10s;
      proxy_send_timeout 30s;
      proxy_read_timeout 30s;
      proxy_buffering on;
    }

    error_page 500 502 503 504  /50x.html;
    location = /50x.html {
      root /usr/share/nginx/html;
    }
}
